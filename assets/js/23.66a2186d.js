(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{466:function(t,e,a){t.exports=a.p+"assets/img/consistent-management-layer.f3f6e5b6.png"},467:function(t,e,a){t.exports=a.p+"assets/img/portal_resource_providers.95273896.png"},468:function(t,e,a){t.exports=a.p+"assets/img/templatedeployment.36cef376.png"},469:function(t,e,a){t.exports=a.p+"assets/img/templatedeploymentparameters.89430a39.png"},470:function(t,e,a){t.exports=a.p+"assets/img/templatedeploymentoutput.3e7f59f9.png"},471:function(t,e,a){t.exports=a.p+"assets/img/vscodegeneratedparams.bc886186.png"},472:function(t,e,a){t.exports=a.p+"assets/img/upload2cloudshell.f19e61ca.png"},473:function(t,e,a){t.exports=a.p+"assets/img/MyARMResult.e4b40008.png"},882:function(t,e,a){"use strict";a.r(e);var s=a(35),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"challenge-7-arm-azure-resource-manager-arm-templates"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#challenge-7-arm-azure-resource-manager-arm-templates"}},[t._v("#")]),t._v(" Challenge 7: ARM - Azure Resource Manager (ARM) Templates")]),t._v(" "),s("h2",{attrs:{id:"here-is-what-you-will-learn-üéØ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn-üéØ"}},[t._v("#")]),t._v(" Here is what you will learn üéØ")]),t._v(" "),s("ul",[s("li",[t._v("get to know the Azure Resource Manager and Resource Providers")]),t._v(" "),s("li",[t._v("learn about how ARM templates are structured and what you can do with them")]),t._v(" "),s("li",[t._v("create a basic template and deploy them via the Azure Portal")]),t._v(" "),s("li",[t._v("work with parameters and deploy using Azure CLI")])]),t._v(" "),s("h2",{attrs:{id:"just-to-be-on-the-same-page"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#just-to-be-on-the-same-page"}},[t._v("#")]),t._v(" Just to be on the same page")]),t._v(" "),s("p",[t._v("Before we can get into Azure Resource Manager and the related templates, we need to clarify some terms:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Resource")]),t._v(" ‚Äì an element manageable via Azure. For example: a virtual machine, a database, a web app etc.")]),t._v(" "),s("li",[s("strong",[t._v("Resource Group")]),t._v(" ‚Äì a container for resources. A resource can not exist in Azure without a ResourceGroup (RG). Deployments of resources are always executed on an RG. Typically, resources with the same lifecycle are grouped into one resource group.")]),t._v(" "),s("li",[s("strong",[t._v("Resource Provider")]),t._v(" ‚Äì an Azure service for creating a resource through the Azure Resource Manager. For example, ‚ÄúMicrosoft.Web‚Äù to create a web app, ‚ÄúMicrosoft.Storage‚Äù to create a storage account etc.")]),t._v(" "),s("li",[s("strong",[t._v("Azure Resource Manager (ARM) Templates")]),t._v(" ‚Äì a JSON file that describes one or more resources that are deployed into a Resource Group. The template can be used to consistently and repeatedly provision the resources.")])]),t._v(" "),s("p",[t._v("One great advantage when using ARM templates, is the "),s("em",[t._v("traceability")]),t._v(" of changes to your infrastructure. Templates can be stored together with the "),s("em",[t._v("source code")]),t._v(" of your application in the code repository ("),s("em",[t._v("Infratructure as Code")]),t._v(").")]),t._v(" "),s("p",[t._v("If you have established Continuous Integration / Deployment in your development process (which we will do on "),s("RouterLink",{attrs:{to:"/day1/day4/"}},[t._v("Day 4")]),t._v("), you can execute the deployment of the infrastructure from Jenkins, TeamCity or Azure DevOps. No one has to worry about an update of the environment ‚Äì web apps, databases, caches etc. will be created and configured automatically ‚Äì no manual steps are necessary (which can be error-prone, as we all know).")],1),t._v(" "),s("h2",{attrs:{id:"table-of-contents"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#table-of-contents"}},[t._v("#")]),t._v(" Table of Contents")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#challenge-7-arm---azure-resource-manager-arm-templates"}},[t._v("Challenge 7: ARM - Azure Resource Manager (ARM) Templates")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#here-is-what-you-will-learn-"}},[t._v("Here is what you will learn üéØ")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#just-to-be-on-the-same-page"}},[t._v("Just to be on the same page")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#table-of-contents"}},[t._v("Table of Contents")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#azure-resource-manager-and-resource-providers"}},[t._v("Azure Resource Manager and Resource Providers")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#arm-templates"}},[t._v("ARM Templates")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#a-basic-template"}},[t._v("A Basic Template")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#lets-deploy-the-template"}},[t._v("Let's deploy the template")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#arm-with-parameter-file"}},[t._v("ARM with Parameter File")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#create-your-first-arm-template"}},[t._v("Create your first ARM Template")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#1-open-visual-studio-code"}},[t._v("1. Open Visual Studio Code")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#2-add-a-resource-to-it"}},[t._v("2. Add a resource to it")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#3-use-an-arm-function"}},[t._v("3. Use an ARM function")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#4-create-a-parameter"}},[t._v("4. Create a parameter")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#5-create-a-parameter-file"}},[t._v("5. Create a parameter file")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#cleanup"}},[t._v("Cleanup")])])])])]),t._v(" "),s("h2",{attrs:{id:"azure-resource-manager-and-resource-providers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#azure-resource-manager-and-resource-providers"}},[t._v("#")]),t._v(" Azure Resource Manager and Resource Providers")]),t._v(" "),s("p",[t._v("The "),s("em",[t._v("Azure Resource Manager")]),t._v(" is the deployment and management service for Azure. It provides a management layer that enables you to create, update, and delete resources in your Azure subscription.")]),t._v(" "),s("p",[t._v("You can access the resource manager through several ways:")]),t._v(" "),s("ul",[s("li",[t._v("Azure Portal")]),t._v(" "),s("li",[t._v("Azure Powershell")]),t._v(" "),s("li",[t._v("Azure CLI")]),t._v(" "),s("li",[t._v("plain REST Calls")]),t._v(" "),s("li",[t._v("SDKs")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(466),alt:"arm",title:"arm"}})]),t._v(" "),s("p",[t._v("As you can see in the picture above, the Resource Manager is made of several "),s("em",[t._v("Resource Providers")]),t._v(" (RP) that are ultimately responsible for provisioning the requested service/resource. Resource providers can be independently enabled or disabled. To see, what RPs are active in your subscription, you can either check the Portal (Subscription --\x3e Resource Providers) or use Azure CLI (e.g. in the "),s("a",{attrs:{href:"https://shell.azure.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud Shell"),s("OutboundLink")],1),t._v(") to query the resource manager:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ az provider list -o table\n\nNamespace                               RegistrationPolicy    RegistrationState\n--------------------------------------  --------------------  -------------------\nMicrosoft.ChangeAnalysis                RegistrationRequired  Registered\nMicrosoft.EventGrid                     RegistrationRequired  Registered\nMicrosoft.Logic                         RegistrationRequired  Registered\nMicrosoft.Security                      RegistrationRequired  Registered\nMicrosoft.PolicyInsights                RegistrationRequired  Registered\nMicrosoft.AlertsManagement              RegistrationRequired  Registered\nMicrosoft.Advisor                       RegistrationRequired  Registered\nMicrosoft.Web                           RegistrationRequired  Registered\nmicrosoft.insights                      RegistrationRequired  Registered\nMicrosoft.KeyVault                      RegistrationRequired  Registered\nMicrosoft.Storage                       RegistrationRequired  Registered\nMicrosoft.Portal                        RegistrationFree      Registered\nMicrosoft.DocumentDB                    RegistrationRequired  Registered\nMicrosoft.Search                        RegistrationRequired  Registered\nMicrosoft.Cdn                           RegistrationRequired  Registered\nMicrosoft.Cache                         RegistrationRequired  Registered\nMicrosoft.ResourceHealth                RegistrationRequired  Registered\nMicrosoft.Sql                           RegistrationRequired  Registered\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("p",[s("img",{attrs:{src:a(467),alt:"providers",title:"providers"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("üìù Resource providers talk REST (what a surprise üòâ)"),s("br"),t._v("\nHere is an example of a REST call that creates a storage account:")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("PUT\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("https")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("//management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/mystorageaccount?api-version=2016-01-01")])]),t._v('\nREQUEST BODY\n{\n  "location": "westus",\n  "sku": {\n    "name": "Standard_LRS"\n  },\n  "kind": "Storage",\n  "properties": {}\n}\n')])])])]),t._v(" "),s("p",[t._v("As you can see, deployments in Azure will always be executed against a "),s("em",[t._v("resource group")]),t._v(", as mentioned before! In this sample, the template will be ultimately picked-up by the "),s("em",[t._v("Microsoft.Storage")]),t._v(" resource provider, which then will be responsible for creating a Storage Account for you.")]),t._v(" "),s("p",[t._v("But of course - nobody wants to construct native REST calls. Instead we focus on the json payload and let Azure CLI or powershell do the REST communication/transmission part."),s("br"),t._v("\nThe json document we are about to create is an "),s("em",[t._v("ARM Template")])]),t._v(" "),s("h2",{attrs:{id:"arm-templates"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arm-templates"}},[t._v("#")]),t._v(" ARM Templates")]),t._v(" "),s("p",[t._v("A full ARM template is more than just a REST json payload. It usually consists of several parts:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"parameters"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"variables"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"outputs"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("parameters")]),t._v(" ‚Äì Parameters (e.g. a virtual machine's name) that are passed from the outside to the template. Typically, from the command line or your deployment tool (e.g. Terraform, Azure DevOps, Jenkins...)")]),t._v(" "),s("li",[s("strong",[t._v("variables")]),t._v(" ‚Äì variables for internal use. Typically, parameters are ‚Äúedited‚Äù, e.g. names are concatenated strings and stored in variables for later use.")]),t._v(" "),s("li",[s("strong",[t._v("resources")]),t._v(" ‚Äì the actual resources to be created")]),t._v(" "),s("li",[s("strong",[t._v("outputs")]),t._v(" ‚Äì Output parameters that are returned to the caller after the template has been successfully applied. With "),s("em",[t._v("outputs")]),t._v(" you can achieve multi-stage deployments by passing outputs to the next ARM template in your deployment chain.")])]),t._v(" "),s("h3",{attrs:{id:"a-basic-template"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#a-basic-template"}},[t._v("#")]),t._v(" A Basic Template")]),t._v(" "),s("p",[t._v("Sticking to our sample from above (Storage Account), let's create a basic template that will create a Storage Account and makes use of a very helpful feature ("),s("em",[t._v("Template Functions")]),t._v("). Here it is:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"parameters"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"storageAccountName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"metadata"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"The name of the storage account to be created."')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"storageAccountType"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"defaultValue"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard_LRS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"allowedValues"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard_LRS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard_GRS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard_ZRS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium_LRS"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"metadata"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Storage Account type"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"variables"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"[parameters('storageAccountName')]\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Microsoft.Storage/storageAccounts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"apiVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2015-06-15"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"location"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[resourceGroup().location]"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tags"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"displayName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"[parameters('storageAccountName')]\"")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"accountType"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"[parameters('storageAccountType')]\"")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"outputs"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"storageAccountConnectionString"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"[listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), providers('Microsoft.Storage', 'storageAccounts').apiVersions[0]).keys[0].value]\"")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("üìù As you can see, we are able to use functions to do dynamic stuff within a template, e.g. reading keys ("),s("code",[t._v("listKeys()")]),t._v(") or using parameter ("),s("code",[t._v("parameters()")]),t._v("). There are, of course, other functions e.g. for string manipulation ("),s("em",[t._v("concatenate")]),t._v(", "),s("em",[t._v("padLeft")]),t._v(", "),s("em",[t._v("split")]),t._v("...), numeric functions, comparison functions, conditionals etc. You can find all available template functions and their documentation here: "),s("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-resource-manager/templates/template-functions",target:"_blank",rel:"noopener noreferrer"}},[t._v("ARM template functions"),s("OutboundLink")],1),t._v(". Please make yourself familiar with the list!")])]),t._v(" "),s("h3",{attrs:{id:"let-s-deploy-the-template"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#let-s-deploy-the-template"}},[t._v("#")]),t._v(" Let's deploy the template")]),t._v(" "),s("p",[t._v("There are several ways to kick off an ARM template deployment:")]),t._v(" "),s("ul",[s("li",[t._v("Azure cli")]),t._v(" "),s("li",[t._v("PowerShell")]),t._v(" "),s("li",[t._v("Azure Portal -> '+' -> 'Template Deployment'")]),t._v(" "),s("li",[t._v("...")])]),t._v(" "),s("p",[t._v("We will try each of these to learn its haptic.")]),t._v(" "),s("ol",[s("li",[t._v("We use the Azure Portal. You may find it strange to use a web portal that offers wizards and use it to process our template. However, when testing/developing templates errors will occur. In this case the portal offers immediate feedback e.g. for validation errors. So do:")])]),t._v(" "),s("p",[s("code",[t._v("[Azure Portal] -> '+' -> 'Template deployment' -> Create -> 'Build your own template in the editor'")])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Copy and paste the above ARM template into the portal editor window")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(468),alt:"Azure Portal Template Deployment"}})]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("Hit save. This will bring you to the next page.")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("üìù This page contains:")]),t._v(" "),s("ul",[s("li",[t._v("fixed elements: The deployment scope - where should your resources be deployed (subscription & RG) - dynamic elements: The parameters - defined in the template will define the 'look' and hence what the user needs to provide.")])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(469),alt:"Template Deployment Parameters"}})]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[t._v("Enter a unique lowercase value for the storage account and kick off the deployment.")])]),t._v(" "),s("li",[s("p",[t._v("When finished take a look at the outputs section:")])])]),t._v(" "),s("p",[s("img",{attrs:{src:a(470),alt:"Template Deployment Output"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("üìù Think of it that way: You can define the outputs of a deployment in the template for later use e.g. if you want to upload something in the next step of your deployment and need the access key for this.")])]),t._v(" "),s("h2",{attrs:{id:"arm-with-parameter-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#arm-with-parameter-file"}},[t._v("#")]),t._v(" ARM with Parameter File")]),t._v(" "),s("p",[t._v("You have noticed that you have been asked to enter a value for the parameter "),s("code",[t._v("storageAccountName")]),t._v(". In a fully automated deployment, this is not really acceptable."),s("br"),t._v("\nUsing e.g. the "),s("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/group/deployment?view=azure-cli-latest#az_group_deployment_create",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure CLI"),s("OutboundLink")],1),t._v(" you can specify an "),s("code",[t._v("answer")]),t._v(" parameter file that goes along with the deployment file.")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("az deployment group create -g basicarm-rg -n firsttemplate --template-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("./azuredeploy.json --parameters"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("@azuredeploy.params.json\n")])])]),s("p",[t._v("Doing so you can set up parameter files for different environments, e.g.:")]),t._v(" "),s("ul",[s("li",[t._v("azuredeploy.params."),s("strong",[t._v("DEV")]),t._v(".json")]),t._v(" "),s("li",[t._v("azuredeploy.params."),s("strong",[t._v("TEST")]),t._v(".json")]),t._v(" "),s("li",[t._v("azuredeploy.params."),s("strong",[t._v("PROD")]),t._v(".json")]),t._v(" "),s("li",[t._v("...")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("üìù One template + multiple parameter files. That's "),s("strong",[t._v("how most people do")]),t._v(" it.")])]),t._v(" "),s("p",[t._v("Example for our storage account parameter:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"parameters"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"storageAccountName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"metadata"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"The name of the storage account to be created."')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n.\n.\n.\n")])])]),s("p",[t._v("The corresponding parameter file would look like this.")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"parameters"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"storageAccountName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"adcmyarmsa"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"create-your-first-arm-template"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-your-first-arm-template"}},[t._v("#")]),t._v(" Create your first ARM Template")]),t._v(" "),s("p",[t._v("Now I want you to create your first ARM Template. A speed course - based on the "),s("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-resource-manager/templates/template-tutorial-create-first-template?tabs=azure-powershell",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tutorial: Create and deploy your first ARM template"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("You will:")]),t._v(" "),s("ul",[s("li",[t._v("Open Visual Studio Code and create an empty ARM template file.")]),t._v(" "),s("li",[t._v("Add a resource to it.")]),t._v(" "),s("li",[t._v("Use an ARM function")]),t._v(" "),s("li",[t._v("Create a parameter")]),t._v(" "),s("li",[t._v("Generate a parameter file")]),t._v(" "),s("li",[t._v("Deploy it using Azure CLI")])]),t._v(" "),s("h3",{attrs:{id:"_1-open-visual-studio-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-open-visual-studio-code"}},[t._v("#")]),t._v(" 1. Open Visual Studio Code")]),t._v(" "),s("p",[t._v("and create an empty ARM template file (e.g. "),s("strong",[s("em",[t._v("pip.json")])]),t._v("). Use the following\ncode snippet")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-add-a-resource-to-it"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-add-a-resource-to-it"}},[t._v("#")]),t._v(" 2. Add a resource to it")]),t._v(" "),s("p",[t._v("Put the json code snippet that defines a public IP address into the resources\nsection of the template")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Microsoft.Network/publicIPAddresses"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"apiVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-06-01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"location"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sku"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"usefulstring"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"publicIPAllocationMethod"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"usefulstring"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"publicIPAddressVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"usefulstring"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("Try a "),s("strong",[t._v("Shift-ALT-F to format the code after inserting")]),t._v(". (requires ARM\nextension to be installed)")])]),t._v(" "),s("p",[t._v("You need to replace the "),s("em",[t._v('"usefulstring"')]),t._v(" with meaningful data. See the following links as reference:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/azure/templates/microsoft.network/publicipaddresses#template-format",target:"_blank",rel:"noopener noreferrer"}},[t._v("Microsoft.Network publicIPAddresses"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("All Azure resources are listed in the "),s("a",{attrs:{href:"https://docs.microsoft.com/azure/templates/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ARM Templates Reference"),s("OutboundLink")],1),t._v(". e.g. Public IP is in the network resource provider.")])]),t._v(" "),s("h3",{attrs:{id:"_3-use-an-arm-function"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-use-an-arm-function"}},[t._v("#")]),t._v(" 3. Use an ARM function")]),t._v(" "),s("p",[t._v("Concentrate on")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"location"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("Azure resources go into a resource group. A resource group is located in an azure region. So you may want to use the same region for your public IP Address as it's hosting resource group."),s("br"),t._v("\nLucky us. There is a function available - that we can use. Replace "),s("em",[t._v('"string"')]),t._v(' with "'),s("code",[t._v("[resourceGroup().location]")]),t._v('"')]),t._v(" "),s("h3",{attrs:{id:"_4-create-a-parameter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-create-a-parameter"}},[t._v("#")]),t._v(" 4. Create a parameter")]),t._v(" "),s("p",[t._v("Create a parameter so that a user can enter the name of the IP Address artefact."),s("br"),t._v("\nTherefore add a parameter section to the template. Checkout "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/template-tutorial-add-parameters?tabs=azure-powershell#make-template-reusable",target:"_blank",rel:"noopener noreferrer"}},[t._v("Make template reusable"),s("OutboundLink")],1),t._v(" to see how it is done.")]),t._v(" "),s("p",[t._v("As example you can compare your ARM Template with the following code snippet:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"parameters"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"IPName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"metadata"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"The name of the Azure IP adress artefact"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"[parameters('IPName')]\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Microsoft.Network/publicIPAddresses"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"apiVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-06-01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"location"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[resourceGroup().location]"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sku"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Basic"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"properties"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"publicIPAllocationMethod"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Static"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"publicIPAddressVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"IPv4"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-create-a-parameter-file"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-create-a-parameter-file"}},[t._v("#")]),t._v(" 5. Create a parameter file")]),t._v(" "),s("p",[t._v("Use VS Code to generate a parameter file for you and enter a value:")]),t._v(" "),s("p",[s("img",{attrs:{src:a(471),alt:"VS Code can generate parameter file"}})]),t._v(" "),s("p",[t._v("As example you can compare your parameters file with the following code snippet:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"$schema"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"contentVersion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"parameters"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"IPName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-PIP"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("Kick off the deployment using Azure CLI. To Do this you can upload the template and parameter file to your Azure Cloud Shell:")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(472),alt:"Upload to Cloud Shell"}})]),t._v(" "),s("p",[t._v("Create a resource group first by executing e.g.:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("az group create -l northeurope -n rg-MyFirstARM\n")])])]),s("p",[t._v("Kick off the deployment by executing e.g.:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("az deployment group create -g rg-MyFirstARM --template-file pip.json --parameters '@pip.parameters.json'\n")])])]),s("p",[t._v("Result:")]),t._v(" "),s("p",[s("img",{attrs:{src:a(473),alt:"My First ARM Template result"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("There exist two modes how to deploy an ARM template:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Complete")]),t._v(" ‚Äì resources that are not present in the template, but do exist in the resource group, are deleted.")]),t._v(" "),s("li",[s("strong",[t._v("Incremental")]),t._v(" (default)‚Äì resources that are not present in the template, but exist in the resource group, remain unchanged.")])])]),t._v(" "),s("h2",{attrs:{id:"cleanup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cleanup"}},[t._v("#")]),t._v(" Cleanup")]),t._v(" "),s("p",[t._v("Execute the following commands:")]),t._v(" "),s("div",{staticClass:"language-PowerShell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("az "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),t._v(" delete "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n basicarm-rg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("no-wait "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("yes\naz "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),t._v(" delete "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n rg-MyFirstARM\n")])])]),s("p",[s("RouterLink",{attrs:{to:"/day1/challenge-06/"}},[t._v("‚óÄ Previous challenge")]),t._v(" | "),s("RouterLink",{attrs:{to:"/day1/"}},[t._v("üîº Day 1")]),t._v(" | "),s("RouterLink",{attrs:{to:"/day1/challenge-08/"}},[t._v("Next challenge ‚ñ∂")])],1)])}),[],!1,null,null,null);e.default=r.exports}}]);